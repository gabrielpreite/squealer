<!DOCTYPE html>
<html>

<head>
  <title>Bootstrap Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!----BOOSTRAP-->
  <!-- CSS only -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

  <script src="https://kit.fontawesome.com/352b6e21d2.js" crossorigin="anonymous"></script>

  <link rel="stylesheet" type="text/css" href="../css/test.css" />

  

</head>

<body>
  <header></header>

  <div class="container-fluid">
    <div class="row">

      <!-- First Column -->
      <div class="col-md-3">
        <h3 class="bg-dark text-center py-2"><a href="#">First Column</a></h3>
      </div>

      <!-- Second Column -->
      <div class="col-md-6">
        <div class="row">
          <h3 class="bg-dark text-center py-2"><a href="#">Second Column</a></h3>
        </div>

        <div class="container pt-2">
          <div class="row">
              <div class="col-10 mx-auto">
                  <form method="post" action="" onsubmit="()">
                      <div class="input-group mb-3">
                          <input class="form-control input-sm searchbar-style" type="text" placeholder="Search" name="query" id="query">
  
                          <select class="form-select" id="filtro" name="filtro" aria-label="Select">
                              <option selected value="default" id="default" onclick="()">
                                Ordina per:</option>
                              <option value="data_ordinamento" id="data_ordinamento" onclick="()">
                                Data</option>
                              <option value="visual" id="visual" onclick="();">
                                Numero di visualizzazioni</option>
                              <option value="Impression" id="Impression" onclick="()">
                                Impression</option>
                          </select>

                          <button type="submit" class="btn searchbar-style" style="color: #1d9bf0;
                          border-color: #1d9bf0;"><em class="fa-solid fa-magnifying-glass"></em>Cerca</button>
                      </div>
                  </form>
              </div>
          </div>
        </div>

          <div class="row overflow-auto" style="height: 50em">
            <div class="container posts-content"> 
              <div class="row contenitore-squeal" id="squeal_contenitore">

                <div class="card squeal"> 
                  <div class="card-header">
                      <img src="https://via.placeholder.com/60x60" alt="Profile Image" class="profile-image" id="squeal_img_utente' + i + '">
                      <div class="info_utente"> 
                          <span class="nome_utente" id="squeal_nome' + i + '">Nome Utente</span>
                          <span class="text-muted tag-username" id="squeal_tag' + i + '">username</span>
                          <span class="text-muted timestamp" id="squeal_timestamp' + i + '">10 minuti fa</span> 
                      </div> 
                      <div class="recipients-dropdown" class="destinatari">
                          <button class="btn btn-link btn-destinatari dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> 
                              Destinatari 
                          </button> 
                          <div class="dropdown-menu" aria-labelledby="destinatari" id="squeal_destinatari' + i + '"> 
                              <a class="dropdown-item" href="#">Alice</a> 
                              <a class="dropdown-item" href="#">Bob</a> 
                              <a class="dropdown-item" href="#">Charlie</a> 
                              <!-- Aggiungi altri destinatari qui --> 
                          </div> 
                      </div> 
                  </div> 
                  <div class="card-body">                 
                      <p id="squeal_testo' + i + '"> </p> 
                  </div> 
                  <div class="card-footer"> 
                      <div class="row reazioni btn-group"> 
                          <div class="col reazioni-left"> 
                              <label class="btn btn-primary btn-reazioni btn-group0"> 
                                <i class="fab fa-sketch reazioni-icone"> </i>
                                <span class="n-reazioni" id="squeal_sketch' + i + '"> 500 </span> 
                              </label>
                              <label class="btn btn-primary btn-reazioni btn-group0">
                                <i class="fas fa-poo reazioni-icone"> </i>
                                <span class="n-reazioni" id="squeal_poo' + i + '"> 500 </span> 
                              </label> 
                          </div> 
                          <div class="col reazioni-mid"> 
                              <label class="btn btn-primary btn-reazioni btn-group0"> 
                                  <i class="fas fa-heart reazioni-icone">  </i>
                                  <span class="n-reazioni" id="squeal_heart' + i + '"> 500 </span>
                              </label> 
                              <label class="btn btn-primary btn-reazioni btn-group0"> 
                                  <i class="fas fa-heart-crack reazioni-icone"> </i>
                                  <span class="n-reazioni" id="squeal_disheart' + i + '"> 500 </span>
                              </label> 
                          </div> 
                          <div class="col reazioni-right"> 
                              <label class="btn btn-primary btn-reazioni btn-group0"> 
                                  <i class="fas fa-thumbs-up reazioni-icone"> </i> 
                                  <span class="n-reazioni" id="squeal_like' + i + '"> 500 </span>
                              </label> 
                              <label class="btn btn-primary btn-reazioni btn-group0"> 
                                  <i class="fas fa-thumbs-down reazioni-icone"> </i> 
                                  <span class="n-reazioni" id="squeal_dislike' + i + '"> 500 </span> 
                              </label> 
                          </div> 
                      </div> 
                      <div class="info-post" id="squeal_info' + i + '"> 
                          <span class="label-squeal visual" id="squeal_visual' + i + '">Visual 500</span> 
                      </div> 
                  </div> 
                </div>
              </div>
                
              
            </div>
              
          </div>
      </div>

      <!-- Third Column -->
      <div class="col-md-3">
        <h3 class="bg-dark text-center py-2"><a href="#">Third Column</a></h3>
      </div>

    </div>
  </div>
    

  <!--JQuery-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
  <!-- JavaScript Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
    crossorigin="anonymous"></script>
  
  <script>
    //richiesta squeal
    var squeals;
    $.ajax({
      type: 'GET',
      dataType: "json",
      async: false,
      url: `https://site212251.tw.cs.unibo.it/api_messaggio`, //${window.location.origin}
      headers: { },
      success: function (data, status, xhr) {
        console.log('data: ', data);
        squeals = data["result"];
      }
    });
    var n_squeal = squeals.length;
        
    var contenitore = document.getElementById('squeal_contenitore');

    for (var i = 0; i < n_squeal; i++) {
      //squeal
      var htmlCode = '<div class="card squeal">    <div class="card-header">        <img src="https://via.placeholder.com/60x60" alt="Profile Image" class="profile-image"            id="squeal_img_utente' + i + '">        <div class="info_utente">            <span class="nome_utente" id="squeal_nome' + i + '">Nome Utente</span>            <span class="text-muted tag-username" id="squeal_tag' + i + '">username</span>            <span class="text-muted timestamp" id="squeal_timestamp' + i + '">10 minuti fa</span>        </div>        <div class="recipients-dropdown" class="destinatari">            <button class="btn btn-link btn-destinatari dropdown-toggle" type="button" data-bs-toggle="dropdown"                aria-haspopup="true" aria-expanded="false">                Destinatari            </button>            <div class="dropdown-menu" aria-labelledby="destinatari" id="squeal_destinatari' + i + '">                <a class="dropdown-item" href="#">Alice</a>                <a class="dropdown-item" href="#">Bob</a>                <a class="dropdown-item" href="#">Charlie</a>                <!-- Aggiungi altri destinatari qui -->            </div>        </div>    </div>    <div class="card-body">        <p id="squeal_testo' + i + '"> </p>    </div>    <div class="card-footer">        <div class="row reazioni btn-group">            <div class="col reazioni-left">                <label class="btn btn-primary btn-reazioni btn-group0">                    <i class="fab fa-sketch reazioni-icone"> </i>                    <span class="n-reazioni" id="squeal_sketch' + i + '"> 500 </span>                </label>                <label class="btn btn-primary btn-reazioni btn-group0">                    <i class="fas fa-poo reazioni-icone"> </i>                    <span class="n-reazioni" id="squeal_poo' + i + '"> 500 </span>                </label>            </div>            <div class="col reazioni-mid">                <label class="btn btn-primary btn-reazioni btn-group0">                    <i class="fas fa-heart reazioni-icone"> </i>                    <span class="n-reazioni" id="squeal_heart' + i + '"> 500 </span>                </label>                <label class="btn btn-primary btn-reazioni btn-group0">                    <i class="fas fa-heart-crack reazioni-icone"> </i>                    <span class="n-reazioni" id="squeal_disheart' + i + '"> 500 </span>                </label>            </div>            <div class="col reazioni-right">                <label class="btn btn-primary btn-reazioni btn-group0">                    <i class="fas fa-thumbs-up reazioni-icone"> </i>                    <span class="n-reazioni" id="squeal_like' + i + '"> 500 </span>                </label>                <label class="btn btn-primary btn-reazioni btn-group0">                    <i class="fas fa-thumbs-down reazioni-icone"> </i>                    <span class="n-reazioni" id="squeal_dislike' + i + '"> 500 </span>                </label>            </div>        </div>        <div class="info-post" id="squeal_info' + i + '">            <span class="label-squeal visual" id="squeal_visual' + i + '">Visual 500</span>        </div>    </div></div></div>';
      contenitore.insertAdjacentHTML('beforeend', htmlCode);

      //info utente
      var id_nome = 'squeal_nome' + i;
      var id_tag = 'squeal_tag' + i;
      var id_timestamp = 'squeal_timestamp' + i;
      //document.getElementById(id_nome).innerHTML = squeals[i].;
      document.getElementById(id_tag).innerHTML = squeals[i].utente;
      document.getElementById(id_timestamp).innerHTML = squeals[i].timestamp;

      //corpo squeal
      var id_testo = 'squeal_testo' + i;
      document.getElementById(id_testo).innerHTML = squeals[i].corpo;

      //destinatari da finire
      var lista_destinatari = document.getElementById('squeal_destinatari' + i);
      var n_destinatari = squeals[i].destinatari.length;
      for (var j = 0; j < n_destinatari; j++) {
        lista_destinatari.insertAdjacentHTML('beforeend', '<a class="dropdown-item" href="#">' + squeals[i].destinatari[j] + '</a>');
      }
      
      //reazioni
      var id_sketch = 'squeal_sketch' + i;
      document.getElementById(id_sketch).innerHTML = '   ' + squeals[i].reazioni.positive.adoro.length;
      var id_poo = 'squeal_poo' + i;
      document.getElementById(id_poo).innerHTML = '   ' + squeals[i].reazioni.negative.mi_disgusta.length;
      var id_heart = 'squeal_heart' + i;
      document.getElementById(id_heart).innerHTML = '   ' + squeals[i].reazioni.positive.mi_piace.length;
      var id_disheart = 'squeal_disheart' + i;
      document.getElementById(id_disheart).innerHTML = '   ' + squeals[i].reazioni.negative.odio.length;
      var id_like = 'squeal_like' + i;
      document.getElementById(id_like).innerHTML = '   ' + squeals[i].reazioni.positive.concordo.length;
      var id_dislike = 'squeal_dislike' + i;
      document.getElementById(id_dislike).innerHTML = '   ' + squeals[i].reazioni.negative.sono_contrario.length;
      
      //etichette
      var id_visual = 'squeal_visual' + i;
      document.getElementById(id_visual).innerHTML = 'Visual: ' + squeals[i].visualizzazioni;
      if (squeals[i].categoria == "popolare"){
        var Et_popolarita = document.getElementById('squeal_info' + i);
        Et_popolarita.insertAdjacentHTML('beforeend', '<span class="label-squeal popolarita"> Popolare </span>');
      } else if (squeals[i].categoria == "impopolare"){
        var Et_popolarita = document.getElementById('squeal_info' + i);
        Et_popolarita.insertAdjacentHTML('beforeend', '<span class="label-squeal popolarita"> Impopolare </span>');
      } else if (squeals[i].automatico == "controverso"){
        var Et_popolarita = document.getElementById('squeal_info' + i);
        Et_popolarita.insertAdjacentHTML('beforeend', '<span class="label-squeal popolarita"> Controverso </span>');
      }
      if (squeals[i].automatico == false){
        var Et_auto = document.getElementById('squeal_info' + i);
        Et_auto.insertAdjacentHTML('beforeend', '<span class="label-squeal auto"> Auto </span>');
      }
      if (squeals[i].pubblico){
        var Et_pubblico = document.getElementById('squeal_info' + i);
        Et_pubblico.insertAdjacentHTML('beforeend', '<span class="label-squeal pubblico"> Privato </span>');
      }
    }

    //bottoni
    document.addEventListener("DOMContentLoaded", function() {
      const buttons = document.querySelectorAll(".btn-reazioni");
      buttons.forEach((button) => {
        button.addEventListener("click", function() {
          //console.log(button.querySelector(".n-reazioni"));
          const buttonGroup = document.querySelectorAll(".btn-group0");
          if (button.checked) {
            button.style.color= "white";
            button.checked = false;
            var Nreaz = button.querySelector(".n-reazioni");
            Nreaz.innerHTML = Nreaz.innerHTML - 1;
          } else {
            buttonGroup.forEach((btnradio) => {
              if (button==btnradio){
                button.style.color= "red";
                button.checked = true;
                var Nreaz = button.querySelector(".n-reazioni");
                console.log(Nreaz.innerHTML);
                Nreaz.innerHTML = Nreaz.innerHTML + 1;
              } else if (btnradio.checked) {
                btnradio.style.color= "white";
                btnradio.checked = false;
                var Nreaz = btnradio.querySelector(".n-reazioni");
                Nreaz.innerHTML = Nreaz.innerHTML - 1;
              }
            });
          }
        });
      });
    });

  </script>
</body>

</html>