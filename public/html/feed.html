<!DOCTYPE html>
<html lang="en-US">

  <head>
    <title>Squealer</title>

    <!----BOOSTRAP-->
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

    <!--Font Awesome-->
    <script src="https://kit.fontawesome.com/352b6e21d2.js" crossorigin="anonymous"></script>

    <!--Google Charts-->
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>

    <!--Fonts-->
    <link href="http://fonts.cdnfonts.com/css/chirp-2" rel="stylesheet">

    <!-- Plotly -->
    <script src="https://cdn.plot.ly/plotly-2.16.3.min.js"></script>

    <!--JavaScript Scripts-->
    <script type="text/javascript" src="../js/global.js"></script>
    <script type="text/javascript" src="../js/feed.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="../css/feed.css">
    <link rel="stylesheet" href="../css/navbar.css">

  </head>
  <body>
    <header>
      <div class="navbar fixed-top">
        <div id="profile">
          <img src="https://via.placeholder.com/60x60" alt="Profile picture">
          <div class="dropdown" id="username">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <strong>
              <script>
                document.write(get_cookie_by_name("username"))
              </script>
            </strong>
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="dropdown-account-smm">
              <h6 class="dropdown-header">Gestisci altri account</h6>
            </div>
          </div>
          <div id="managed-account-username" onclick="switch_to_smm()"></div>
        </div>
        <div id="quota">
          <div class="char-count-item">
            <span class="count" id="charCount_mese">

            </span>
            <span class="label">Mese</span>
          </div>
          <div class="char-count-item">
            <span class="count" id="charCount_sett">

            </span>
            <span class="label">Settimana</span>
          </div>
          <div class="char-count-item">
            <span class="count" id="charCount_giorno">

            </span>
            <span class="label">Giorno</span>
          </div>
      <button class="btn btn-unstyled" id="shopButton">
    <i class="fas fa-shopping-cart"></i>
  </button>
    </div>
    <div class="lateral-buttons">
      <div id="notifiche">
      <button class="btn btn-unstyled" id="notificationsButton" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <i class="fas fa-bell"></i>
      </button>
      <div class="dropdown-menu dropdown-menu-end" id="notificationsDropdown" aria-labelledby="notificationsButton">
        <h3 class="dropdown-header">Notifiche</h3>
        <a class="dropdown-item" href="#">Notifica 1</a>
        <a class="dropdown-item" href="#">Notifica 2</a>
        <a class="dropdown-item" href="#">Notifica 3</a>
        <!-- Aggiungi altre notifiche qui -->
      </div>
    </div>
    <!-- VERSIONE HOME
    <div id="home">
      <button class="btn btn-unstyled" id="homeButton">
        <i class="fas fa-home"></i>
      </button>
    </div>
      -->
    <div id="impostazioni">
      <button class="btn btn-unstiled" id="settingsButton" onclick="redirectToSettings()">
        <i class="fas fa-cog"></i>
      </button>
    </div>
    </div>
    <script type="text/javascript">
      // Assegna i valori alle variabili
      let quota_giorno = get_cookie_by_name("quota_giorno");
      let quota_settimana = get_cookie_by_name("quota_settimana");
      let quota_mese = get_cookie_by_name("quota_mese");

      // Aggiorna il contenuto delle span con i nuovi valori
      document.getElementById("charCount_mese").textContent = quota_mese;
      document.getElementById("charCount_sett").textContent = quota_settimana;
      document.getElementById("charCount_giorno").textContent = quota_giorno;
    </script>

      </div>
    </header>

    <body>

      <!--PULSANTE NUOVO SQUEAL-->
      <div class="fixed-button" id="nuovo-squeal">
        <button class="round-button" onclick="redirectToEditor()">
          +
        </button>
      </div>

        <!-- First Column -->
        <div class="col-md-3 barra-scorrimento" id="col-sx">
          <div class="social-channels">
            <a href="" class="channel-button" style="margin-left: 15px"><i class="fas fa-wrench"></i> Staff</a>
            <a href="" class="channel-button"><i class="far fa-newspaper fa-fw"></i> News</a>
            <a href="" class="channel-button" style="margin-right: 5px;"><i class="far fa-sun"></i> Meteo</a>
            <a href="" class="channel-button small">...</a>
          </div>

          <h4 class="statistiche-title" style="text-align: left">Tendenze</h4>
          <ol class="tendenze-list">
            <li class="tendenze-item">
              <span class="tendenze-tag"><a href="#">#hashtag</a></span>
              <span class="tendenze-count">100k Squeals</span>
            </li>
            <li class="tendenze-item">
              <span class="tendenze-tag"><a href="#">#hashtag</a></span>
              <span class="tendenze-count">80k Squeals</span>
            </li>
            <li class="tendenze-item">
              <span class="tendenze-tag"><a href="#">#hashtag</a></span>
              <span class="tendenze-count">50k Squeals</span>
            </li>
            <li class="tendenze-item">
              <span class="tendenze-tag"><a href="#">#hashtag</a></span>
              <span class="tendenze-count">40k Squeals</span>
            </li>
            <li class="tendenze-item">
              <span class="tendenze-tag"><a href="#">#hashtag</a></span>
              <span class="tendenze-count">30k Squeals</span>
            </li>
          </ol>

          <h4 class="statistiche-title">Trend</h4>
          <div class="grafico mosaic-container">
              <!-- Le tessere del mosaico saranno generate dinamicamente con JavaScript -->
          </div>

          <h4 class="statistiche-title">Picchi di utenza</h4>
          <div class="grafico" id="grafico-attivita"></div>

        </div>

        <!-- Second Column -->
        <div class="col-md-6" id="feed">

          <div class="searchbar">
            <div class="barra">
              <form id="form_ricerca">
                <div class="input-group mb-3">
                  <select class="form-select" id="tipo" name="tipo" aria-label="Select">
                    <option selected value="default" id="default">
                      Cerca:</option>
                    <option value="utente" id="utente">
                      @</option>
                    <option value="canale" id="canale">
                      $</option>
                    <option value="keyword" id="keyword">
                      #</option>
                  </select>

                  <input class="form-control input-sm searchbar-style" type="text" placeholder="Search" name="query" id="query">

                  <select class="form-select" id="filtro" name="filtro" aria-label="Select">
                    <option selected value="data" id="data">
                      Data</option>
                    <option value="visual" id="visual">
                      Numero di visualizzazioni</option>
                    <option value="impression" id="impression">
                      Impression</option>
                  </select>

                  <button type="submit" class="btn searchbar-style" style="color: #1d9bf0;
                    border-color: #1d9bf0;"><em class="fa-solid fa-magnifying-glass"></em>Cerca</button>
                </div>
              </form>
            </div>
          </div>

          <div class="contenitore-squeal posts-content barra-scorrimento" id="squeal_contenitore">



          </div>

        </div>

        <!-- Third Column -->
        <div class="col-md-3" id="col-dx">
          <div id="vuoto" hidden="false">

           </div>
           <div id="mostra-commenti" hidden="true">
             <h4 class="statistiche-title">Commenti<i class="fa-solid fa-times icona-chiudi" onclick="aggiungicommento('chiudi')"></i></h4>
             <div class="contenitore-commenti barra-scorrimento">
                 <div class="comment">
                   <img src="https://via.placeholder.com/48x48" alt="Profile Image" class="comment-profile-image">
                   <div class="comment-content">
                     <strong class="comment-username">Nome Utente</strong>
                     <p class="comment-text">Questo è un commento.</p>
                   </div>
                 </div>
                 <div class="comment">
                   <img src="https://via.placeholder.com/48x48" alt="Profile Image" class="comment-profile-image">
                   <div class="comment-content">
                     <strong class="comment-username">Nome Utente</strong>
                     <p class="comment-text">Questo è un commento.</p>
                   </div>
                 </div>
                 <div class="comment">
                   <img src="https://via.placeholder.com/48x48" alt="Profile Image" class="comment-profile-image">
                   <div class="comment-content">
                     <strong class="comment-username">Nome Utente</strong>
                     <p class="comment-text">Questo è un commento.</p>
                   </div>
                 </div>
                 <div class="comment">
                   <img src="https://via.placeholder.com/48x48" alt="Profile Image" class="comment-profile-image">
                   <div class="comment-content">
                     <strong class="comment-username">Nome Utente</strong>
                     <p class="comment-text">Questo è un commento.</p>
                   </div>
                 </div>
                 <div class="comment">
                   <img src="https://via.placeholder.com/48x48" alt="Profile Image" class="comment-profile-image">
                   <div class="comment-content">
                     <strong class="comment-username">Nome Utente</strong>
                     <p class="comment-text">Questo è un commento.</p>
                   </div>
                 </div>
                 <div class="comment">
                   <img src="https://via.placeholder.com/48x48" alt="Profile Image" class="comment-profile-image">
                   <div class="comment-content">
                     <strong class="comment-username">Nome Utente</strong>
                     <p class="comment-text">Questo è un commento.</p>
                   </div>
                 </div>
                 <div class="comment">
                   <img src="https://via.placeholder.com/48x48" alt="Profile Image" class="comment-profile-image">
                   <div class="comment-content">
                     <strong class="comment-username">Nome Utente</strong>
                     <p class="comment-text">Questo è un commento.</p>
                   </div>
                 </div>
                 <div class="comment">
                   <img src="https://via.placeholder.com/48x48" alt="Profile Image" class="comment-profile-image">
                   <div class="comment-content">
                     <strong class="comment-username">Nome Utente</strong>
                     <p class="comment-text">Questo è un commento.</p>
                   </div>
                 </div>
                 <div class="comment">
                   <img src="https://via.placeholder.com/48x48" alt="Profile Image" class="comment-profile-image">
                   <div class="comment-content">
                     <strong class="comment-username">Nome Utente</strong>
                     <p class="comment-text">Questo è un commento.</p>
                   </div>
                 </div>
                 <div class="comment">
                   <img src="https://via.placeholder.com/48x48" alt="Profile Image" class="comment-profile-image">
                   <div class="comment-content">
                     <strong class="comment-username">Nome Utente</strong>
                     <p class="comment-text">Questo è un commento.</p>
                   </div>
                 </div>
                 <div class="comment">
                   <img src="https://via.placeholder.com/48x48" alt="Profile Image" class="comment-profile-image">
                   <div class="comment-content">
                     <strong class="comment-username">Nome Utente</strong>
                     <p class="comment-text">Questo è un commento.</p>
                   </div>
                 </div>
                 <div class="comment">
                   <img src="https://via.placeholder.com/48x48" alt="Profile Image" class="comment-profile-image">
                   <div class="comment-content">
                     <strong class="comment-username">Nome Utente</strong>
                     <p class="comment-text">Questo è un commento.</p>
                   </div>
                 </div>

               <!-- Altri commenti possono essere inseriti qui -->
             </div>
             <div class="">
             <button id="aggiungi-commento" class="btn btn-primary" onclick="aggiungicommento('commenta')">
               Commenta   <i class="fa-solid fa-comment-dots icona-commento"></i>
             </button>
           </div>
           </div>
        </div>

      <!--JQuery-->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
      <!-- JavaScript Bundle with Popper -->
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
        crossorigin="anonymous"></script>

      <script>
        document.getElementById("form_ricerca").addEventListener('submit', async event => {
          event.preventDefault();
          squeals = ricerca_squeal().post;
          var info_ricerca = ricerca_squeal().meta;
        });

        // INSERIMENTO ACCOUNT GESTITI DA SMM
        let account = []
        $.ajax({
          type: 'GET',
          dataType: "json",
          async: false,
          url: `https://site212251.tw.cs.unibo.it/get_managed`,
          headers: { },
          success: function (data, status, xhr) {
            console.log('data: ', data);
            account = data;
          }
        });

        account.forEach((el) => {
          $("#dropdown-account-smm").append(`<button class="dropdown-item" type="button" onclick="switch_account('${el}')">${el}</button>`)
        })

        //se sto gestendo un account lo mostro nella barra
        let managed = get_cookie_by_name("managed")
        if(!(managed === undefined)){
          $("#managed-account-username").text(managed)
        }

        //RICHIESTA E COSTRUZIONE SQUEAL
        var squeals;
        $.ajax({
          type: 'GET',
          dataType: "json",
          async: false,
          url: `https://site212251.tw.cs.unibo.it/user_feed`,
          headers: { },
          success: function (data, status, xhr) {
            console.log('data: ', data);
            squeals = data;
          }
        });

        //setup
        var adoro = "adoro";
        var mi_disgusta = "mi_disgusta";
        var mi_piace = "mi_piace";
        var odio = "odio";
        var concordo = "concordo";
        var sono_contrario = "sono_contrario";
        aggiungi_squeal(squeals);

        //bottoni
        function premibottone(button, reac, id) {
          //console.log(button.querySelector(".n-reazioni"));
          if (button.checked) {
            button.style.color= "#777";
            button.checked = false;
            var Nreaz = button.querySelector(".n-reazioni");
            Nreaz.innerHTML = parseInt(Nreaz.innerHTML) - 1;
          } else {
            const buttonGroup = document.getElementsByClassName(button.className);
            const buttonArray = Array.from(buttonGroup);
            //console.log(buttonGroup);
            buttonArray.forEach((btnradio) => {
              if (button==btnradio){
                if (reac == "adoro"){
                  button.style.color= "#00AFFF";
                } else if (reac == "mi_disgusta") {
                  button.style.color= "#8B4513";
                } else if (reac == "mi_piace") {
                  button.style.color= "#FF0000";
                } else if (reac == "odio") {
                  button.style.color= "#FF0000";
                } else if (reac == "concordo") {
                  button.style.color= "#007FFF";
                } else if (reac == "sono_contrario") {
                  button.style.color= "#007FFF";
                }
                button.checked = true;
                var Nreaz = btnradio.querySelector(".n-reazioni");
                Nreaz.innerHTML = parseInt(Nreaz.innerHTML) + 1;
              } else if (btnradio.checked) {
                btnradio.style.color= "#777";
                btnradio.checked = false;
                var Nreaz = btnradio.querySelector(".n-reazioni");
                Nreaz.innerHTML = parseInt(Nreaz.innerHTML) - 1;
              }
            });
          }

          //controllo a chi assegnare la reaction
          let target_user = get_cookie_by_name("username")
          let managed = get_cookie_by_name("managed")
          if(!(managed === undefined))
            target_user = managed

          //chiamata update db
          $.ajax({
            type: 'GET',
            dataType: "json",
            async: false,
            url: `https://site212251.tw.cs.unibo.it/update_reazioni`,
            data: { _id: id, reac: reac, userid: target_user},
            headers: { },
            success: function (data, status, xhr) {
              console.log('data: ', data);
            }
          });
        }

        function aggiungicommento(azione) {
          var icon = document.querySelector('.fa-solid.fa-comments');
          if (azione == "apri") {
            if (document.getElementById("mostra-commenti").hidden == true) {
              // Cambia il colore dell'icona del commento a nero
              icon.style.color = 'black';
              // Nascondi il div "vuoto"
              document.getElementById("vuoto").hidden = true;
              // Mostra il div "mostra-squeal"
              document.getElementById("mostra-commenti").hidden = false;
            } else {
              icon.style.color = '#777';
              document.getElementById("vuoto").hidden = false;
              document.getElementById("mostra-commenti").hidden = true;
            }
          } else if (azione == "chiudi") {
            icon.style.color = '#777';
            document.getElementById("vuoto").hidden = false;
            document.getElementById("mostra-commenti").hidden = true;
          } else {
            //apri editor commento
          }
        }

        function riempiFeed(){

        }

        function redirectToEditor() {
          window.location.href = "/editor";
        }

        function redirectToSettings() {
          window.location.href = "/settings";
        }

        function redirectToHome() {
          window.location.href = "/";
        }

        google.charts.load('current', { 'packages': ['corechart'] });
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
          var data = google.visualization.arrayToDataTable([
            ['Orario', 'Utenti'],
            [00, 120],
            [02, 80],
            [05, 150],
            [08, 250],
            [12, 320],
            [16, 280],
            [19, 200],
            [22, 180],
          ]);

          var options = {
            height: 200,
            width: 305.4,
            legend: { position: 'none' },
            vAxis: { minValue: 0 },
            hAxis: {
              gridlines: { color: 'transparent' },
              ticks: [
                {v: 00, f: '0:00'},
                {v: 01, f: ''},
                {v: 02, f: ''},
                {v: 03, f: ''},
                {v: 04, f: ''},
                {v: 05, f: ''},
                {v: 06, f: '6:00'},
                {v: 07, f: ''},
                {v: 08, f: ''},
                {v: 09, f: ''},
                {v: 10, f: ''},
                {v: 11, f: ''},
                {v: 12, f: '12:00'},
                {v: 13, f: ''},
                {v: 14, f: ''},
                {v: 15, f: ''},
                {v: 16, f: ''},
                {v: 17, f: ''},
                {v: 18, f: '18:00'},
                {v: 19, f: ''},
                {v: 20, f: ''},
                {v: 21, f: ''},
                {v: 22, f: ''},
                {v: 23, f: ''},
              ],
              slantedText: false,
            },
            series: {
              0: { type: 'line', color: '#4285F4' },
            },
            backgroundColor: 'transparent',
          };

          var chart = new google.visualization.LineChart(document.getElementById('grafico-attivita'));
          chart.draw(data, options);
        }

        // TRENDS
        const pastelColors = [
          '#FF8080', '#FFB380', '#FFD480', '#FFFF80', '#BFFF80',
          '#80FF80', '#80FFBF', '#C0B3FF', '#CFAEFF'
        ];

        function getRandomPastelColor() {
          const randomIndex = Math.floor(Math.random() * pastelColors.length);
          return pastelColors[randomIndex];
        }

        // Crea le tessere del mosaico dinamicamente
        function createMosaicTiles() {
          const container = document.querySelector('.mosaic-container');
          const tileSize = 30; // Dimensione della tessera

          // Array dei trend
          var trends = ['#Trend1', '#prova', '#ciaociaociao', '#Trend4', '#squealer'];

          for (let i = 0; i < trends.length; i++) {
            const tile = document.createElement('a');
            tile.classList.add('mosaic-tile');
            tile.style.backgroundColor = getRandomPastelColor();
            tile.textContent = trends[i];
            tile.style.width = trends[i].length * 10 + 'px'; // Imposta la larghezza in base alla lunghezza della parola
            tile.style.height = tileSize + 'px';
            tile.href = '#'; // Imposta l'URL del link

            container.appendChild(tile);
          }
        }
        createMosaicTiles();

      </script>
  </body>
</html>
