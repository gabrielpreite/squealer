<!DOCTYPE html>
<html lang="en-US">

<head>
    <title>Squealer</title>

    <!----BOOSTRAP-->
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

    <!--Font Awesome-->
    <script src="https://kit.fontawesome.com/352b6e21d2.js" crossorigin="anonymous"></script>

    <!--Google Charts-->
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>

    <!--Fonts-->
    <link href="http://fonts.cdnfonts.com/css/chirp-2" rel="stylesheet">

    <!-- Plotly -->
    <script src="https://cdn.plot.ly/plotly-2.16.3.min.js"></script>

    <!--JavaScript Scripts-->
    <script type="text/javascript" src="../js/global.js"></script>
    <script type="text/javascript" src="../js/feed.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="../css/feed.css">
    <link rel="stylesheet" href="../css/navbar.css">

</head>
<body>
    <header>
      <div class="navbar fixed-top">
        <div id="profile">
          <img src="https://via.placeholder.com/60x60" alt="Profile picture">
          <div class="dropdown" id="username">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <strong>
              <script>
                document.write(get_cookie_by_name("username"))
              </script>
            </strong>
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <h6 class="dropdown-header">Gestisci altri account</h6>
              <button class="dropdown-item" type="button">Felon Muskrat</button>
              <button class="dropdown-item" type="button">Tizio Caio</button>
              <button class="dropdown-item" type="button">Sempronio Boh</button>
            </div>
          </div>
        </div>
        <div id="quota">
          <div class="char-count-item">
            <span class="count" id="charCount_mese">

            </span>
            <span class="label">Mese</span>
          </div>
          <div class="char-count-item">
            <span class="count" id="charCount_sett">

            </span>
            <span class="label">Settimana</span>
          </div>
          <div class="char-count-item">
            <span class="count" id="charCount_giorno">

            </span>
            <span class="label">Giorno</span>
          </div>
      <button class="btn btn-unstyled" id="shopButton">
    <i class="fas fa-shopping-cart"></i>
  </button>
    </div>
    <div class="lateral-buttons">
      <div id="notifiche">
      <button class="btn btn-unstyled" id="notificationsButton" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <i class="fas fa-bell"></i>
      </button>
      <div class="dropdown-menu dropdown-menu-end" id="notificationsDropdown" aria-labelledby="notificationsButton">
        <h3 class="dropdown-header">Notifiche</h3>
        <a class="dropdown-item" href="#">Notifica 1</a>
        <a class="dropdown-item" href="#">Notifica 2</a>
        <a class="dropdown-item" href="#">Notifica 3</a>
        <!-- Aggiungi altre notifiche qui -->
      </div>
    </div>
    <!-- VERSIONE HOME
    <div id="home">
      <button class="btn btn-unstyled" id="homeButton">
        <i class="fas fa-home"></i>
      </button>
    </div>
      -->
    <div id="impostazioni">
      <button class="btn btn-unstiled" id="settingsButton" onclick="redirectToSettings()">
        <i class="fas fa-cog"></i>
      </button>
    </div>
    </div>
    <script type="text/javascript">
      // Assegna i valori alle variabili
      let quota_giorno = get_cookie_by_name("quota_giorno");
      let quota_settimana = get_cookie_by_name("quota_settimana");
      let quota_mese = get_cookie_by_name("quota_mese");

      // Aggiorna il contenuto delle span con i nuovi valori
      document.getElementById("charCount_mese").textContent = quota_mese;
      document.getElementById("charCount_sett").textContent = quota_settimana;
      document.getElementById("charCount_giorno").textContent = quota_giorno;
    </script>

      </div>
    </header>

    <body>

      <!--PULSANTE NUOVO SQUEAL-->
      <div class="fixed-button" id="nuovo-squeal">
        <button class="round-button" onclick="redirectToEditor()">
          +
        </button>
      </div>

      <div class="container-fluid">
        <div class="row">

          <!-- First Column -->
          <div class="col-md-3" id="col-sx">
            <div class="social-channels">
              <a href="" class="channel-button" style="margin-left: 15px"><i class="fas fa-wrench"></i> Staff</a>
              <a href="" class="channel-button"><i class="far fa-newspaper fa-fw"></i> News</a>
              <a href="" class="channel-button" style="margin-right: 5px;"><i class="far fa-sun"></i> Meteo</a>
              <a href="" class="channel-button small">...</a>
            </div>

            <h4 class="statistiche-title" style="text-align: left">Tendenze</h4>
            <ol class="tendenze-list">
              <li class="tendenze-item">
                <span class="tendenze-tag"><a href="#">#hashtag</a></span>
                <span class="tendenze-count">100k Squeals</span>
              </li>
              <li class="tendenze-item">
                <span class="tendenze-tag"><a href="#">#hashtag</a></span>
                <span class="tendenze-count">80k Squeals</span>
              </li>
              <li class="tendenze-item">
                <span class="tendenze-tag"><a href="#">#hashtag</a></span>
                <span class="tendenze-count">50k Squeals</span>
              </li>
              <li class="tendenze-item">
                <span class="tendenze-tag"><a href="#">#hashtag</a></span>
                <span class="tendenze-count">40k Squeals</span>
              </li>
              <li class="tendenze-item">
                <span class="tendenze-tag"><a href="#">#hashtag</a></span>
                <span class="tendenze-count">30k Squeals</span>
              </li>
            </ol>

            <h4 class="statistiche-title">Trend</h4>
            <div class="grafico mosaic-container">
                <!-- Le tessere del mosaico saranno generate dinamicamente con JavaScript -->
            </div>

            <h4 class="statistiche-title">Picchi di utenza</h4>
            <div class="grafico" id="grafico-attivita"></div>

          </div>

          <!-- Second Column -->
          <div class="col-md-6" id="feed">

            <div class="container pt-2">
              <div class="row">
                  <div class="col-10 mx-auto">
                      <form method="GET" action="/search">
                          <div class="input-group mb-3">
                              <input class="form-control input-sm searchbar-style" type="text" placeholder="Search" name="query" id="query">

                              <select class="form-select" id="filtro" name="filtro" aria-label="Select">
                                  <option selected value="default" id="default" onclick="">
                                    Ordina per:</option>
                                  <option value="data" id="data" onclick="">
                                    Data</option>
                                  <option value="visual" id="visual" onclick="">
                                    Numero di visualizzazioni</option>
                                  <option value="Impression" id="Impression" onclick="">
                                    Impression</option>
                              </select>

                              <button type="submit" class="btn searchbar-style" style="color: #1d9bf0;
                              border-color: #1d9bf0;"><em class="fa-solid fa-magnifying-glass"></em>Cerca</button>
                          </div>
                      </form>
                  </div>
              </div>
            </div>

            <div class="row overflow-auto" style="height: 50em">
              <div class="container posts-content">
                <div class="row contenitore-squeal" id="squeal_contenitore">



                </div>

              </div>
            </div>

          </div>

            <!-- Third Column -->
            <div class="col-md-3" id="col-dx">

            </div>

          </div>
        </div>

      <!--JQuery-->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
      <!-- JavaScript Bundle with Popper -->
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
        crossorigin="anonymous"></script>

        <script>
          //RICHIESTA E COSTRUZIONE SQUEAL
          var squeals;
          $.ajax({
            type: 'GET',
            dataType: "json",
            async: false,
            url: `https://site212251.tw.cs.unibo.it/api_messaggio`, //${window.location.origin}
            headers: { },
            success: function (data, status, xhr) {
              console.log('data: ', data);
              squeals = data["result"];
            }
          });
          var n_squeal = squeals.length;

          var contenitore = document.getElementById('squeal_contenitore');

          for (var i = 0; i < n_squeal; i++) {
            //squeal
            var htmlCode = '<div class="card squeal"> <div class="card-header"> <img src="https://via.placeholder.com/60x60" alt="Profile Image" class="profile-image" id="squeal_img_utente' + i + '"> <div class="info_utente"> <span class="nome_utente" id="squeal_nome' + i + '">Nome Utente</span> <span class="text-muted tag-username" id="squeal_tag' + i + '">   </span> <span class="text-muted timestamp" id="squeal_timestamp' + i + '">10 minuti fa</span> </div> <div class="recipients-dropdown" class="destinatari"> <button class="btn btn-link dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> Destinatari </button> <div class="dropdown-menu" aria-labelledby="destinatari"> <a class="dropdown-item" href="#">Alice</a> <a class="dropdown-item" href="#">Bob</a> <a class="dropdown-item" href="#">Charlie</a> <!-- Aggiungi altri destinatari qui --> </div> </div> </div> <div class="card-body">                 <p id="squeal_testo' + i + '"> </p> </div> <div class="card-footer"> <div class="row reazioni"> <div class="col reazioni-left"> <a class="btn btn-primary" href="#!" role="button" > <i class="fab fa-sketch reazioni-icone"></i> </a> <a class="btn btn-primary" href="#!" role="button" > <i class="fas fa-poo reazioni-icone"></i> </a> </div> <div class="col reazioni-mid"> <a class="btn btn-primary" href="#!" role="button" > <i class="fas fa-heart reazioni-icone"></i> </a> <a class="btn btn-primary" href="#!" role="button" > <i class="fas fa-heart-crack reazioni-icone"></i> </a> </div> <div class="col reazioni-right"> <a class="btn btn-primary" href="#!" role="button" > <i class="fas fa-thumbs-up reazioni-icone"></i> </a> <a class="btn btn-primary" href="#!" role="button" > <i class="fas fa-thumbs-down reazioni-icone"></i> </a> </div> </div> <div class="info-post" id="squeal_info' + i + '"> <span class="label-squeal visual" id="squeal_visual' + i + '">Visual 500</span> </div> </div> </div>';
            contenitore.insertAdjacentHTML('beforeend', htmlCode);

            //info utente
            var id_nome = 'squeal_nome' + i;
            var id_tag = 'squeal_tag' + i;
            var id_timestamp = 'squeal_timestamp' + i;
            //document.getElementById(id_nome).innerHTML = squeals[i].;
            document.getElementById(id_tag).innerHTML = squeals[i].utente;
            document.getElementById(id_timestamp).innerHTML = squeals[i].timestamp;

            //corpo squeal
            var id_testo = 'squeal_testo' + i;
            document.getElementById(id_testo).innerHTML = squeals[i].corpo;

            //destinatari da finire
            var lista_destinatari = document.getElementById('squeal_destinatari' + i);
            var n_destinatari = squeals[i].destinatari.length;
            if (squeals[i].destinatari[0] != '&free'){
              for (var j = 0; j < n_destinatari; j++) {
                lista_destinatari.insertAdjacentHTML('beforeend', '<a class="dropdown-item" href="#">' + squeals[i].destinatari[j] + '</a>');
              }
            }

            //reazioni


            //etichette
            var id_visual = 'squeal_visual' + i;
            document.getElementById(id_visual).innerHTML = 'Visual: ' + squeals[i].visualizzazioni;
            if (squeals[i].categoria == "popolare"){
              var Et_popolarita = document.getElementById('squeal_info' + i);
              Et_popolarita.insertAdjacentHTML('beforeend', '<span class="label-squeal popolarita"> Popolare </span>');
            } else if (squeals[i].categoria == "impopolare"){
              var Et_popolarita = document.getElementById('squeal_info' + i);
              Et_popolarita.insertAdjacentHTML('beforeend', '<span class="label-squeal popolarita"> Impopolare </span>');
            } else if (squeals[i].automatico == "controverso"){
              var Et_popolarita = document.getElementById('squeal_info' + i);
              Et_popolarita.insertAdjacentHTML('beforeend', '<span class="label-squeal popolarita"> Controverso </span>');
            }
            if (squeals[i].automatico){
              var Et_auto = document.getElementById('squeal_info' + i);
              Et_auto.insertAdjacentHTML('beforeend', '<span class="label-squeal auto"> Auto </span>');
            }
            if (!squeals[i].pubblico){
              var Et_pubblico = document.getElementById('squeal_info' + i);
              Et_pubblico.insertAdjacentHTML('beforeend', '<span class="label-squeal pubblico"> Privato </span>');
            }
          }
          //FINE SQUEAL

          function riempiFeed(){

          }

          function redirectToEditor() {
            window.location.href = "/editor";
          }

          function redirectToSettings() {
            window.location.href = "/settings";
          }

          function redirectToHome() {
            window.location.href = "/";
          }

          google.charts.load('current', { 'packages': ['corechart'] });
          google.charts.setOnLoadCallback(drawChart);

          function drawChart() {
            var data = google.visualization.arrayToDataTable([
              ['Orario', 'Utenti'],
              [00, 120],
              [02, 80],
              [05, 150],
              [08, 250],
              [12, 320],
              [16, 280],
              [19, 200],
              [22, 180],
            ]);

            var options = {
              height: 200,
              width: 305.4,
              legend: { position: 'none' },
              vAxis: { minValue: 0 },
              hAxis: {
                gridlines: { color: 'transparent' },
                ticks: [
                  {v: 00, f: '0:00'},
                  {v: 01, f: ''},
                  {v: 02, f: ''},
                  {v: 03, f: ''},
                  {v: 04, f: ''},
                  {v: 05, f: ''},
                  {v: 06, f: '6:00'},
                  {v: 07, f: ''},
                  {v: 08, f: ''},
                  {v: 09, f: ''},
                  {v: 10, f: ''},
                  {v: 11, f: ''},
                  {v: 12, f: '12:00'},
                  {v: 13, f: ''},
                  {v: 14, f: ''},
                  {v: 15, f: ''},
                  {v: 16, f: ''},
                  {v: 17, f: ''},
                  {v: 18, f: '18:00'},
                  {v: 19, f: ''},
                  {v: 20, f: ''},
                  {v: 21, f: ''},
                  {v: 22, f: ''},
                  {v: 23, f: ''},
                ],
                slantedText: false,
              },
              series: {
                0: { type: 'line', color: '#4285F4' },
              },
              backgroundColor: 'transparent',
            };

            var chart = new google.visualization.LineChart(document.getElementById('grafico-attivita'));
            chart.draw(data, options);
          }

          // TRENDS
          const pastelColors = [
            '#FF8080', '#FFB380', '#FFD480', '#FFFF80', '#BFFF80',
            '#80FF80', '#80FFBF', '#C0B3FF', '#CFAEFF'
          ];

          function getRandomPastelColor() {
            const randomIndex = Math.floor(Math.random() * pastelColors.length);
            return pastelColors[randomIndex];
          }

          // Crea le tessere del mosaico dinamicamente
          function createMosaicTiles() {
            const container = document.querySelector('.mosaic-container');
            const tileSize = 30; // Dimensione della tessera

            // Array dei trend
            var trends = ['#Trend1', '#prova', '#ciaociaociao', '#Trend4', '#squealer'];

            for (let i = 0; i < trends.length; i++) {
              const tile = document.createElement('a');
              tile.classList.add('mosaic-tile');
              tile.style.backgroundColor = getRandomPastelColor();
              tile.textContent = trends[i];
              tile.style.width = trends[i].length * 10 + 'px'; // Imposta la larghezza in base alla lunghezza della parola
              tile.style.height = tileSize + 'px';
              tile.href = '#'; // Imposta l'URL del link

              container.appendChild(tile);
            }
          }
          createMosaicTiles();
        </script>
    </body>

</html>
